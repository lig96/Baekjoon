# [Platinum II] Отличная лекция - 30850 

[문제 링크](https://www.acmicpc.net/problem/30850) 

### 성능 요약

메모리: 211668 KB, 시간: 1384 ms

### 분류

자료 구조, 깊이 우선 탐색, 분리 집합, 그래프 이론, 그래프 탐색, 세그먼트 트리

### 제출 일자

2024년 5월 13일 00:04:49

### 문제 설명

<p>В одном очень известном университете часто важные люди приходят читать интересные лекции. Лекция обычно состоит из последовательности дедуктивных следствий «из A следует Б». При этом почти все люди обладают способностью к логическому мышлению: если они знают, что из A следует Б, и из Б следует В, то они вполне вправе считать, что из А следует В. Поскольку лектор не любит совсем бессмысленные следствия, то он никогда не выводит одно и то же утверждение дважды (т.е. не существует двух следствий вида «из А следует Б» и «из В следует Б»).</p>

<p>На очередную лекцию пришло несколько студентов. Каждый из них уже обладает некоторыми знаниями о мире (а именно, он знает, что некоторые утверждения — ложны, а некоторые — истинны). В ходе лекции лектор сообщает им некоторые дедуктивные следствия, которые, однако, в какой-то момент могут прийти в противоречие со знаниями студента (к примеру, если студент знал, что A ложно, а Б — истинно, а лектор сообщает, что «из Б следует А»). Вам необходимо для каждого студента узнать первый момент, когда рассуждения лектора приводят к противоречию с его знаниями. Противоречием называется момент, когда из набора истинных для студента утверждений с помощью дедутивных следствий лектора студент может логически вывести утверждение, которое он считает ложным.</p>

<p>Разберем пример типичной лекции. Предположим, что на лекции лектор сообщает следствия «из А следует Б», «из В следует Г», «из Б следует В», а студент считает, что А — истинно, а Г — ложно. Студент слушает следствия по одному, после добавления первого следствия «из А следует Б» студент думает, что Б — истинно. После добавления второго следствия противоречия также не происходит. После добавления третьего следствия «из Б следует В» студент думает, что В — истинно, и он (используя второе следствие лектора) может вывести, что Г — истинно, что противоречит его знаниям (ведь изначально он считал, что Г — ложно).</p>

<p>Если же в разобранном примере другой студент считал, что А — ложно, а Г — истинно, то для него противоречия не происходит ни в какой момент (даже зная все следствия лектора, он не может вывести из истинного утверждения вывести ложное).</p>

### 입력 

 <p>В первой строке входных данных содержится число M — количество дедуктивных следствий лектора (1 ⩽ M ⩽ 500 000). В следующих M строках содержатся описания следствий, каждое из них описывается двумя числами a<sub>i</sub> и b<sub>i</sub> , обозначающих антецедент (посылку) и консеквент (заключение) очередного следствия (a<sub>i</sub> ≠ b<sub>i</sub>, 1 ⩽ a<sub>i</sub>, b<sub>i</sub> ⩽ 500 000), т.е. лектор сообщает, что из утверждения a<sub>i</sub> следует утверждение b<sub>i</sub>, все b<sub>i</sub> являются различными.</p>

<p>В следующей строке содержится число Q — количество студентов (1 ⩽ Q ⩽ 500 000). Далее содержится описание знаний каждого студента. Описание начинается с числа t<sub>i</sub> — количества утверждений, которые студент считает истинным, после которого следует t<sub>i</sub> чисел —- номеров этих утверждений. Далее описание содержит число f<sub>i</sub> — количество утверждений, которые студент считает ложным, после которого следует f<sub>i</sub> чисел — номеров этих утверждений.</p>

<p>Все номера утверждений лежат в пределах от 1 до 500 000. В отличие от действительности, каждый студент хоть что-то знает, т.е. t<sub>i</sub> + f<sub>i</sub> > 0. Отметим, что все номера утверждений, упомянутые одним студентом, различны. Общее количество упомянутых кем-либо утверждений (сумма t<sub>i</sub> + f<sub>i</sub> по всем i) не превосходит 500 000.</p>

### 출력 

 <p>Для каждого студента выведите номер первого следствия лектора, которое приводит к противоречию с его картиной мира, или −1, если они полностью согласны со всеми следствиями лектора.</p>

